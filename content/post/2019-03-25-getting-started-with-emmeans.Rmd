---
title: Getting started with emmeans
author: Ariel Muldoon
date: '2019-03-25'
slug: getting-started-with-emmeans
categories:
  - r
  - statistics
tags:
  - analysis
  - teaching
keywords:
  - tech
draft: TRUE
description: "Using emmeans for multiple comparisons is super useful.  This post goes through some of the basics for those just getting started with the package."
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(comment = "#")
```

```{r, echo = FALSE}
# Make dataset here that will use later
# Two factors plus one log-normal response
set.seed(16)
dat = data.frame(f1 = rep(c("a", "b", "control"), each = 9),
                 f2 = rep(c("1", "2", "control"), times = 9) )
y = with(dat, 0 + 
              2*(f1 == "a" & f2 == "2") +
              -1*(f1 == "a" & f2 == "control") +
              .5*(f1 == "b" & f2 == "1") +
              3*(f1 == "b" & f2 == "2") +
              -2*(f1 == "b" & f2 == "control") +
              -.5*(f1 == "control" & f2 == "1") +
              -.25*(f1 == "control" & f2 == "2") +
              1*(f1 == "control" & f2 == "control") +
              rnorm(n = 27, mean = 0, sd = 1) )
dat$resp = round(exp(y), 1)
```

Package **emmeans** (formerly known as **lsmeans**) is enormously useful for folks wanting to do post hoc comparisons among groups after fitting a model.  It has a very thorough set of vignettes (see the vignette topics [here](https://cran.r-project.org/web/packages/emmeans/vignettes/basics.html#more)), is very flexible with a ton of options, and works out of the box with a lot of different model objects (and can be extended to others).  

I've started recommending **emmeans** a lot to students fitting models in R.  However, I've found that often times students struggle a bit to get started, possibly due to the sheer amount of flexibility and info in the vignettes.  

I've put together some basic examples of **emmeans** for folks just starting out, meant to be a complement to the vignettes.  Specifically this post will go over some of the built-in options for comparisons; I will write a post about custom contrasts in **emmeans** at a later date.

*Disclaimer: This post is about using a package in R and so unfortunately does not focus much on appropriate statistical practice.*

# R packages

I will load **magrittr** for the pipe in addition to **emmeans**.

```{r}
library(emmeans) # v. 1.3.3
library(magrittr) # v. 1.5
```

# The dataset and model

I've made a small dataset to use in examples instead of using the built-in dataset.  The response variable is `resp`, which comes from the log-normal distribution, and the two crossed factors of interest are `f1` and `f2`.  Each factor has a control group, called `control`.

```{r}
dat = structure(list(f1 = structure(c(1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 
1L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 3L, 3L, 3L, 3L, 3L, 3L, 
3L, 3L, 3L), .Label = c("a", "b", "control"), class = "factor"), 
    f2 = structure(c(1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 
    2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L, 1L, 
    2L, 3L), .Label = c("1", "2", "control"), class = "factor"), 
    resp = c(1.6, 6.5, 1.1, 0.2, 23.3, 0.2, 0.4, 7.9, 1, 2.9, 
    127.4, 0.2, 0.8, 105.4, 0.3, 0.3, 35.7, 0.2, 0.4, 2.4, 0.5, 
    0.4, 0.6, 11.8, 0.3, 3.6, 7.8)), row.names = c(NA, -27L), class = "data.frame")
str(dat)
```

The model of interest is a linear model with a log-transformed response and the two factors as their interaction as explanatory variables.  This is the "true" model since I created these data so I'm skipping the checks of the model here, which I would not do in a real analysis.

Note I use `log(resp)` in the model rather than creating a new log-transformed variable.  This will allow me to demonstrate one of the options in `emmeans()` later.

```{r}
fit1 = lm(log(resp) ~ f1 + f2 + f1:f2, data = dat)
```

