---
title: 'Simulate! Simulate! - Part3: The Poisson edition'
author: Ariel Muldoon
date: '2018-07-13'
slug: simulate-poisson-edition
categories:
  - r
  - statistics
tags:
  - simulation
  - glmm
draft: TRUE
description: "I show how to simulate Poisson data to explore what a quadratic relationship looks like on the scale of the data when fitting a generalized linear model with a log link."
---



<p>One of the things I like about simulations is that, with practice, simulating data becomes easier and can be an quik way to check your intuition about a model.</p>
<p>My most recent example is based on a discussion with a student about quadratic effects on the log scale.</p>
<p>First, I never had a great grasp on what the different coefficients in a quadratic relationship were telling me (i.e., how do I interpret them?). Luckily there is this very nice <a href="https://stats.idre.ucla.edu/other/mult-pkg/faq/general/faqhow-do-i-interpret-the-sign-of-the-quadratic-term-in-a-polynomial-regression/">FAQ page</a> from Institute for Digital Research and Education at UCLA that goes over this in detail. This has become my go-to page when I need a review of this (which seems like is every time the topic comes up üòú).</p>
<p>But in this case the student was working with a generalized linear mixed model for count data, which was <em>linear on the log scale</em>. If something is quadratic on the log scale, what does the relationship look like on the original scale?</p>
<p>I wasn‚Äôt certain, although I had a guess. Logically, if something that is a straight line on the log scale is curved on the data scale then something that is curved on the log scale should be <em>more</em> curved on the original scale. But how much more curved? I wasn‚Äôt sure.</p>
<p>After the student left I threw together a quick simulation to see what a relationship like the one he had estimated would look like on the original scale. I sent the code along to him and I think we both benefited from seeing the results.</p>
<div id="the-statistical-model" class="section level1">
<h1>The statistical model</h1>
<p>Even though I did a single iteration simulation, I think it is still useful to write out the statistical model I used. It has been the combination of seeing the equations and then doing simulations (and then seeing the equations in a new light) that has really helped me understand generalized linear (mixed) models and so I like to include the models explicitly in these posts. But if you‚Äôre at a place where you find looking at these equations mind-numbing, <a href="#code-to-simulate-the-quadratic-generalized-linear-model">jump down to the code</a></p>
<p>I‚Äôm going to use a Poisson generalized linear model for my simulation, so the response variable will be counts.</p>
<p>Writing out a generalized linear model is pretty different than the way we do it for the very special case of the normal distribution that most of us probably learned first. Instead of defining the distribution of the errors like we have before we now directly define the distribution of the response variable.</p>
<p>Here I‚Äôll define a respone variable that comes from the Poisson distribuiton.</p>
<p><span class="math display">\[y_t \thicksim Poisson(\lambda_t)\]</span></p>
<ul>
<li><span class="math inline">\(y_t\)</span> is the recorded count for the <span class="math inline">\(t\)</span>th observation of the discrete response variable.<br />
</li>
<li><span class="math inline">\(\lambda_t\)</span> is the unobserved true mean of the Poisson distribution for the <span class="math inline">\(t\)</span>th observation. The Poisson distribution is a single parameter distribution, where the variance is exactly equal the mean.</li>
</ul>
<p>We assume that the relationship between the <em>mean</em> of the response and any explanatory variables is linear on the log scale. This can be described as using a <em>log link</em>, since this is the function that ‚Äúlinks‚Äù the mean to the linear predictor. This is a big change for the linear models I learned originally, where we described the relationship between the <em>response variable</em> and the explanatory variables.</p>
<p>Today the model is a quadratic model for a single, continuous explanatory variable.</p>
<p><span class="math display">\[log(\lambda_t) = \beta_0 + \beta_1*x_t + \beta_2*x^2_t\]</span></p>
<ul>
<li><span class="math inline">\(x_t\)</span> is the recorded value of the <span class="math inline">\(t\)</span>th observation of the continuous explanatory variable<br />
</li>
<li><span class="math inline">\(x^2_t\)</span> is the square of <span class="math inline">\(x_t\)</span><br />
</li>
<li><span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_1\)</span>, and <span class="math inline">\(\beta_2\)</span> are parameters (intercepts and slope coefficients) of the linear model</li>
</ul>
<p>If you are new to generalized linear models you should take note of the absence of epsilon in the linear predictor.</p>
<p>It‚Äôs important to note that by exponentiating both sides of the above equation we can calculate the mean on the original scale instead of the log scale.</p>
<p><span class="math display">\[\lambda_t = exp(\beta_0 + \beta_1*x_t + \beta_2*x^2_t)\]</span></p>
</div>
<div id="code-to-simulate-the-quadratic-generalized-linear-model" class="section level1">
<h1>Code to simulate the quadratic generalized linear model</h1>
<p>The first thing I will do is define my true parameter values. I‚Äôm simulating a relationship between x and y that is similar to what the student‚Äôs results so I‚Äôll set the intercept and the linear coefficient (<span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>, respectively) both to 0.5 and the quadratic coefficient (<span class="math inline">\(\beta_2\)</span>) to 5.</p>
<pre class="r"><code>b0 = .5
b1 = .5
b2 = 5</code></pre>
<p>Then I need a simulated explantory variable that I‚Äôll call <code>x</code>. I decided to make this a continuous variable between 0 and 1 so I made random draws from a uniform distribution with a minimum of 0 and a maximum of 1 via <code>runif()</code>. I arbitrarily to use 100 observsations for this simulation.</p>
<p>I‚Äôll set my seed prior to generating random numbers so you‚Äôll see the same result if you run this code.</p>
<pre class="r"><code>set.seed(16)
x = runif(100, min = 0, max = 1)
head(x)</code></pre>
<pre><code>## [1] 0.6831101 0.2441174 0.4501114 0.2294351 0.8635079 0.3112003</code></pre>
<p>Once I have my parameters set and an explanatory variable I can calculate <span class="math inline">\(\lambda_t\)</span> based on the linear model. I use the equation in the statistical model to figure out how to write the code. Because I want to calculate the means I use the equation after exponentiating both sides as I pointed out above.</p>
<p>So I‚Äôll simulate <span class="math inline">\(\lambda_t\)</span> via</p>
<p><span class="math display">\[\lambda_t = exp(0.5 + 0.5*x_t + 5*x^2_t)\]</span></p>
<pre class="r"><code>lambda = exp(b0 + b1*x + b2*x^2)</code></pre>
<p>The step above simulates the <em>mean</em> of the distribution, not the response variable. These values are continuous, not discrete.</p>
<pre class="r"><code>head(lambda)</code></pre>
<pre><code>## [1]  23.920881   2.509354   5.686283   2.405890 105.634346   3.126231</code></pre>
<p>Now that I have a vector of means I can use it to generate counts from the Poisson distribution for each value of <code>lambda</code>. I do this via <code>rpois()</code> with the vector of means. Each count is drawn from a Poisson distribution with the mean defined from <code>lambda</code>.</p>
<p>The next bit of code is based on the distribution we defined in the statistical model.</p>
<p>Remember that we defined <code>y</code> as:</p>
<p><span class="math display">\[y_t \thicksim Poisson(\lambda_t)\]</span>
I‚Äôve seen this called ‚Äúadding Poisson noise‚Äù to the mean to create the response variable.</p>
<p>We‚Äôll simulate 100 counts to match the 100 means that we have in <code>lambda</code>.</p>
<pre class="r"><code>y = rpois(100, lambda = lambda) </code></pre>
<p>Unlike <code>lambda</code>, the <code>y</code> variable is a discrete count.</p>
<pre class="r"><code>head(y)</code></pre>
<pre><code>## [1]  25   4   5   4 114   2</code></pre>
<p>Now we have simulated our response and our explanatory variable and so can take a look at what the relationship between <code>x</code> and <code>y</code>, which was the goal of all of this.</p>
<p>Here is what things look like on the log scale (the scale of the model). I was interested to see that, while the relationship was curved up as expected by the quadratic coefficient I set, the curve was really quite shallow.</p>
<pre class="r"><code>plot(x, log(y) )</code></pre>
<p><img src="/post/2018-07-13-simulate-poisson-edition_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>So how do things look on the original scale? The curve is now quite extreme, much more than I realized it would be.</p>
<p>This was good to see, though, as it matched pretty well with an added variable plot the student had made. He had been concerned that he had made his plot incorrectly and this helped reassure him that this sort of thing wasn‚Äôt unusual when working with quadratic relationships on the log scale.</p>
<pre class="r"><code>plot(x, y)</code></pre>
<p><img src="/post/2018-07-13-simulate-poisson-edition_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
